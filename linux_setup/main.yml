- name: linux setup
  hosts: "{{ host }}"
  vars:
    apps:
      - discord
      - knowte
      - 1password
      - postman
      - signal-desktop

    classic_apps:
      - code
      - android-studio

    packages:
      - git
      - ansible
      - quiterss
      - xclip
      - vim
      - conky-all
      - testdisk
      - curl

    github_url: "https://github.com/ElQwerto110100100/toolbox"

    fav_theme: "Yaru-dark"

    fav_toolbar: "['firefox.desktop', 'org.gnome.Nautilus.desktop', 'code_code.desktop', 'org.gnome.Terminal.desktop', '1password_1password.desktop', 'install4j_a177y-BurpSuiteCommunity.desktop', 'discord_discord.desktop', 'gnome-control-center.desktop']"

  tasks:
    - name: "Root Tasks"
      block: 
        - name: "Update all packages to their latest version"
          apt:
            name: "*"
            state: latest

        - name: "Upgrade the OS (apt-get dist-upgrade)"
          apt:
            upgrade: dist

        - name: "Install classic snaps"
          snap:
            name: "{{ item }}"
          loop: "{{  classic_apps }}"

        - name: "Install other snaps"
          snap:
            name: "{{ item }}"
          loop: "{{ apps }}"

        - name: "Installing packages"
          apt:
            name: "{{ item }}"
          loop: "{{ packages }}"

        - name: "Get git toolbox"
          git:
            repo: "{{ github_url }}"
            dest: ~/tools/linux_tools/          
        - name: "Set 'sensible' vim config folder"
          file: 
            state: directory
            path: ~/.vim/pack/tpope/start

        - name: "Get 'sensible' vim congif repo"
          git:
            repo: "https://tpope.io/vim/sensible.git"
            dest: ~/.vim/pack/tpope/start

        - name: "Install homebrew"
          command: '/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"'
      become: yes

    - name: "non root tasks"
      block:
        - name: "Make tools dir"
          file:
            state: directory
            path: ~/tools
            
        - name: "Set dark theme"
          command: "gsettings set org.gnome.desktop.interface gtk-theme '{{ fav_theme }}'"
        
        - name: "Set favourite toolbar"
          command: 'gsettings set org.gnome.shell favorite-apps "{{ fav_toolbar }}" ' 
          tags: 'toolbar'

        - name: "Set up cronky config"
          copy:
            src: ./files/.conkyrc
            dest: ~/.conkyrc
          tags: conky

        - name: "Set startup task"
          copy: 
            src: ./files/conky.desktop
            dest: ~/.config/autostart/conky.desktop
          tags: conky

        - name: "Set startup weather"
          copy: 
            src: ./files/weather.desktop
            dest: ~/.config/autostart/weather.desktop

        - name: "Copy rss feed list"
          copy:
            src: ./files/my-feeds.opml
            dest: ~/Documents

        - name: "nvm"
          shell: >
            curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.38.0/install.sh | bash
          args:
            creates: "{{ ansible_env.HOME }}/.nvm/nvm.sh"

        - name: "Import vim config"
          copy: 
            src: ./files/.vimrc
            dest: ~/.vimrc
